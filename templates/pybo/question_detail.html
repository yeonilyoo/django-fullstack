{% extends 'base.html' %}
{% load i18n %}
{% load pybo_filter %}
{% block content %}
    <div class="container my-3">
        {% include "pybo/question_detail/messages.html" %}

        <div style="display: flex; align-items: center; gap: 1rem;">
            <span class="badge {{ question.category|category_badge_class }}">
                                {{ question.get_category_display }}
            </span>
            <h2 class="border-bottom py2">{{ question.subject }}</h2>
        </div>
        {% include "pybo/question_detail/question_question.html" %}
        <h5 class="border-bottom my-3 py-2">
            {{ question.answer_set.count }} {% trans "QUESTION_DETAIL.ANSWERS_EXIST" %}
        </h5>
        <!-- start of answer -->
        <div class="row justify-content-between my-3">
            <div class="col-8">
                <div class="row mb-3">
                    <div class="col-4">
                        <select class="form-control so">
                            <option value="recent"
                                    {% if so == 'recent' %}selected{% endif %}>recent
                            </option>
                            <option value="old"
                                    {% if so == 'old' %}selected{% endif %}>old
                            </option>
                            <option value="popular"
                                    {% if so == 'popular' %}selected{% endif %}>popular
                            </option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="col-4">
                <div class="input-group">
                    <input type="text" class="form-control kw" value="{{ kw|default_if_none:'' }}">
                    <div class="input-group-append">
                        <button class="btn btn-outline-secondary" type="button" id="btn_search">
                            {% trans "QUESTION_LIST.SEARCH" %}
                        </button>
                    </div>
                </div>
            </div>
        </div>
        {#{% for answer in question.answer_set.all %}#}
        {% include "pybo/question_detail/question_answer.html" %}
        <ul class="pagination justify-content-center">
            {% if question_list.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="#"
                       data-page="{{ answer_list.previous_page_number }}">{% trans "QUESTION_LIST.TABLE.PREVIOUS" %}</a>
                </li>
            {% else %}
                <li class="page-item disabled">
                    <a class="page-link" tabindex="-1" aria-disabled="true"
                       href="#">{% trans "QUESTION_LIST.TABLE.PREVIOUS" %}</a>
                </li>
            {% endif %}
            {% for page_number in page_range %}
                <li class="page-item {% if page_number == answer_list.number %}active{% endif %}"
                    {% if page_number == answer_list.number %}aria-current="page"{% endif %}>
                    <a class="page-link" href="#" data-page="{{ page_number }}">{{ page_number }}</a>
                </li>
            {% endfor %}
            {% if answer_list.has_next %}
                <li class="page-item">
                    <a class="page-link" href="#"
                       data-page="{{ answer_list.next_page_number }}">{% trans "QUESTION_LIST.TABLE.NEXT" %}</a>
                </li>
            {% else %}
                <li class="page-item disabled">
                    <a class="page-link" tabindex="-1" aria-disabled="true"
                       href="#">{% trans "QUESTION_LIST.TABLE.NEXT" %}</a>
                </li>
            {% endif %}
        </ul>
        <form action="{% url 'pybo:answer_create' question.id %}" method="post" class="my-3">
            {% csrf_token %}
            {% if form.errors %}
                <div class="alert alert-danger" role="alert">
                    {% for field in form %}
                        {% if field.errors %}
                            <strong>{{ field.label }}</strong>
                            {{ field.errors }}
                        {% endif %}
                    {% endfor %}
                </div>
            {% endif %}
            <div class="form-group">
            <textarea name="content" id="content"
                      {% if not user.is_authenticated %}disabled{% endif %}
                      class="form-control" rows="10"></textarea>
            </div>
            <input type="submit" value="{% trans "QUESTION_DETAIL.SUBMIT" %}" class="btn btn-primary">
        </form>
    </div>
    <form id="searchForm" method="GET" action="{% url 'pybo:detail' question.id %}">
        <input type="hidden" id="kw" name="kw" value="{{ kw|default_if_none:'' }}">
        <input type="hidden" id="page" name="page" value="{{ page }}">
        <input type="hidden" id="so" name="so" value="{{ so }}">
    </form>
{% endblock %}

{% block script %}
    <script type="text/javascript">
        $(document).ready(function () {
            $(".delete").on('click', function () {
                if (confirm("{% trans "QUESTION_DETAIL.DELETE_CONFIRM" %}")) {
                    location.href = $(this).data('uri');
                }
            });
            $(".recommend").on('click', function () {
                if (confirm("{% trans "QUESTION_DETAIL.RECOMMEND_CONFIRM" %}")) {
                    location.href = $(this).data('uri');
                }
            });
            $(".page-link").on('click', function () {
                $('#page').val($(this).data("page"));
                $("#searchForm").submit();
            });
            $("#btn_search").on('click', function () {
                $("#kw").val($(".kw").val());
                $("#page").val(1);
                $("#searchForm").submit();
            });
            $(".kw").on('keypress', function (e) {
                {# enter #}
                if (e.which === 13) {
                    e.preventDefault();
                    $("#kw").val($(".kw").val());
                    $("#page").val(1);
                    $("#searchForm").submit();
                }
            });
            $(".so").on('change', function () {
                $("#so").val($(this).val());
                $("#page").val(1);
                $("#searchForm").submit();
            });
        });
    </script>
{% endblock %}