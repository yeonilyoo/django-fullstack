{% extends 'base.html' %}
{% load i18n %}
{% load qna_filter %}
{% block content %}
    <div class="container my-3">
        {% include "QnA/question_detail/messages.html" %}

        <div style="display: flex; align-items: center; gap: 1rem;">
            <span class="badge {{ question.category|category_badge_class }}">
                                {{ question.get_category_display }}
            </span>
            <h2 class="border-bottom py2">{{ question.subject }}</h2>
        </div>
        {% include "QnA/question_detail/question_question.html" %}
        <h5 class="border-bottom my-3 py-2">
            {{ question.answer_set.count }} {% trans "QUESTION_DETAIL.ANSWERS_EXIST" %}
        </h5>
        <!-- start of answer -->
        {% include "QnA/question_detail/question_answer_filter.html" %}
        {#{% for answer in question.answer_set.all %}#}
        {% include "QnA/question_detail/question_answer.html" %}
        {% include "QnA/question_detail/question_answer_page_nav.html" %}
        <form action="{% url 'QnA:answer_create' question.id %}" method="post" class="my-3">
            {% csrf_token %}
            {% if form.errors %}
                <div class="alert alert-danger" role="alert">
                    {% for field in form %}
                        {% if field.errors %}
                            <strong>{{ field.label }}</strong>
                            {{ field.errors }}
                        {% endif %}
                    {% endfor %}
                </div>
            {% endif %}
            <div class="form-group">
            <textarea name="content" id="content"
                      {% if not user.is_authenticated %}disabled{% endif %}
                      class="form-control" rows="10"></textarea>
            </div>
            <input type="submit" value="{% trans "QUESTION_DETAIL.SUBMIT" %}" class="btn btn-primary">
        </form>
    </div>
    <form id="searchForm" method="GET" action="{% url 'QnA:detail' question.id %}">
        <input type="hidden" id="kw" name="kw" value="{{ kw|default_if_none:'' }}">
        <input type="hidden" id="page" name="page" value="{{ page }}">
        <input type="hidden" id="so" name="so" value="{{ so }}">
    </form>
{% endblock %}

{% block script %}
    <script type="text/javascript">
        $(document).ready(function () {
            $(".delete").on('click', function () {
                if (confirm("{% trans "QUESTION_DETAIL.DELETE_CONFIRM" %}")) {
                    location.href = $(this).data('uri');
                }
            });
            $(".recommend").on('click', function () {
                if (confirm("{% trans "QUESTION_DETAIL.RECOMMEND_CONFIRM" %}")) {
                    location.href = $(this).data('uri');
                }
            });
            $(".page-link").on('click', function () {
                $('#page').val($(this).data("page"));
                $("#searchForm").submit();
            });
            $("#btn_search").on('click', function () {
                $("#kw").val($(".kw").val());
                $("#page").val(1);
                $("#searchForm").submit();
            });
            $(".kw").on('keypress', function (e) {
                {# enter #}
                if (e.which === 13) {
                    e.preventDefault();
                    $("#kw").val($(".kw").val());
                    $("#page").val(1);
                    $("#searchForm").submit();
                }
            });
            $(".so").on('change', function () {
                $("#so").val($(this).val());
                $("#page").val(1);
                $("#searchForm").submit();
            });
        });
    </script>
{% endblock %}